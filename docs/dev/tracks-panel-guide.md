# TracksPanel - éŸ³è½¨ç®¡ç†ä¾§è¾¹æ 

## æ¦‚è¿°

TracksPanel æ˜¯éŸ³è½¨ç®¡ç†çš„ä¾§è¾¹æ ç»„ä»¶ï¼Œä» TracksModal é‡æ„è€Œæ¥ã€‚é‡‡ç”¨ä¸ SettingsPanel ä¸€è‡´çš„ä¾§è¾¹æ è®¾è®¡ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸å…³é—­é¢æ¿çš„æƒ…å†µä¸‹å®æ—¶æŸ¥çœ‹éŸ³è½¨è°ƒæ•´æ•ˆæœã€‚

## è®¾è®¡ç†å¿µ

### ğŸ¯ ä¸ºä»€ä¹ˆæ”¹ä¸ºä¾§è¾¹æ ï¼Ÿ

**åŸæœ‰ Modal è®¾è®¡çš„é—®é¢˜ï¼š**
- âŒ Modal é®æŒ¡è§†å›¾ï¼Œæ— æ³•å®æ—¶æŸ¥çœ‹è°ƒæ•´æ•ˆæœ
- âŒ éœ€è¦"å…³é—­ â†’ æŸ¥çœ‹æ•ˆæœ â†’ é‡æ–°æ‰“å¼€ â†’ ç»§ç»­è°ƒæ•´"çš„å¾ªç¯
- âŒ ç”¨æˆ·ä½“éªŒä¸ä½³ï¼Œç‰¹åˆ«æ˜¯è°ƒæ•´éŸ³é‡ã€ç§»è°ƒæ—¶

**ä¾§è¾¹æ è®¾è®¡çš„ä¼˜åŠ¿ï¼š**
- âœ… ä»å·¦ä¾§æ»‘å…¥ï¼Œä¸å®Œå…¨é®æŒ¡è°±é¢
- âœ… å®æ—¶æŸ¥çœ‹è°ƒæ•´æ•ˆæœï¼ˆéŸ³é‡ã€ç§»è°ƒç­‰ï¼‰
- âœ… ä¸ SettingsPanel ä¿æŒä¸€è‡´çš„äº¤äº’ä½“éªŒ
- âœ… å¯åŒæ—¶æ‰“å¼€å¤šä¸ªé¢æ¿ï¼ˆSettings åœ¨å³ï¼ŒTracks åœ¨å·¦ï¼‰

### ğŸ¨ è®¾è®¡ä¸€è‡´æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Obsidian Workspace             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Tracks   â”‚             â”‚ Settings â”‚  â”‚
â”‚  â”‚ Panel    â”‚             â”‚ Panel    â”‚  â”‚
â”‚  â”‚ (Left)   â”‚             â”‚ (Right)  â”‚  â”‚
â”‚  â”‚          â”‚             â”‚          â”‚  â”‚
â”‚  â”‚ â€¢ Solo   â”‚             â”‚ â€¢ Scale  â”‚  â”‚
â”‚  â”‚ â€¢ Mute   â”‚  Main View  â”‚ â€¢ Layout â”‚  â”‚
â”‚  â”‚ â€¢ Volume â”‚             â”‚ â€¢ Player â”‚  â”‚
â”‚  â”‚ â€¢ ç§»è°ƒ    â”‚             â”‚ â€¢ Core   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åŠŸèƒ½ç‰¹æ€§

### ğŸ“‹ éŸ³è½¨åˆ—è¡¨
- æ˜¾ç¤ºå½“å‰æ›²è°±çš„æ‰€æœ‰éŸ³è½¨
- å¤é€‰æ¡†é€‰æ‹©/å–æ¶ˆé€‰æ‹©éŸ³è½¨
- éŸ³è½¨åç§°æ˜¾ç¤ºï¼ˆæ”¯æŒé•¿åç§°æˆªæ–­ï¼‰
- é€‰ä¸­çŠ¶æ€å®æ—¶åŒæ­¥

### ğŸ›ï¸ å•éŸ³è½¨æ§åˆ¶

æ¯ä¸ªéŸ³è½¨æä¾›ä»¥ä¸‹æ§åˆ¶ï¼š

#### 1. Solo / Mute æŒ‰é’®
- **Solo**: ç‹¬å¥å½“å‰éŸ³è½¨ï¼ˆå…¶ä»–éŸ³è½¨é™éŸ³ï¼‰
- **Mute**: é™éŸ³å½“å‰éŸ³è½¨
- å›¾æ ‡çŠ¶æ€ï¼šæ¿€æ´»æ—¶é«˜äº®æ˜¾ç¤º

#### 2. éŸ³é‡æ»‘å—
- èŒƒå›´ï¼š0-16ï¼ˆAlphaTab æ ‡å‡†ï¼‰
- æ˜¾ç¤ºç™¾åˆ†æ¯”ï¼š0-100%
- å®æ—¶ç”Ÿæ•ˆï¼Œæ— éœ€å…³é—­é¢æ¿

#### 3. å®Œå…¨ç§»è°ƒ
- èŒƒå›´ï¼š-12 ~ +12 åŠéŸ³
- åŒæ—¶å½±å“éŸ³é¢‘æ’­æ”¾å’Œä¹è°±æ˜¾ç¤º
- é€‚ç”¨äºè½¬è°ƒéœ€æ±‚

#### 4. éŸ³é¢‘ç§»è°ƒ
- èŒƒå›´ï¼š-12 ~ +12 åŠéŸ³
- ä»…å½±å“éŸ³é¢‘æ’­æ”¾ï¼Œä¸æ”¹å˜ä¹è°±
- é€‚ç”¨äºä¼´å¥éœ€æ±‚

### ğŸ”§ æ‰¹é‡æ“ä½œ
- **å…¨é€‰**: é€‰æ‹©æ‰€æœ‰éŸ³è½¨
- **æ¸…ç©º**: ä»…ä¿ç•™ç¬¬ä¸€ä¸ªéŸ³è½¨

### ğŸ“Š çŠ¶æ€ä¿¡æ¯
- æ˜¾ç¤ºå·²é€‰ä¸­éŸ³è½¨æ•° / æ€»éŸ³è½¨æ•°
- ä¾‹å¦‚ï¼š"3 / 5 tracks selected"

## æ¶æ„è®¾è®¡

### ç»„ä»¶å±‚çº§

```
TablatureView
  â”œâ”€â”€ PlayBar
  â”‚     â”œâ”€â”€ TracksToggle (åˆ‡æ¢æŒ‰é’®)
  â”‚     â””â”€â”€ ...
  â””â”€â”€ TracksPanel (ä¾§è¾¹æ )
        â”œâ”€â”€ Header (æ ‡é¢˜ + æ“ä½œæŒ‰é’®)
        â”œâ”€â”€ Content (éŸ³è½¨åˆ—è¡¨)
        â”‚     â””â”€â”€ TrackItem[] (éŸ³è½¨é¡¹)
        â”‚           â”œâ”€â”€ Solo/Mute æŒ‰é’®
        â”‚           â”œâ”€â”€ éŸ³é‡æ»‘å—
        â”‚           â”œâ”€â”€ ç§»è°ƒæ§åˆ¶
        â”‚           â””â”€â”€ StaffItem[] (äº”çº¿è°±é€‰é¡¹)
        â””â”€â”€ Footer (çŠ¶æ€ä¿¡æ¯)
```

### çŠ¶æ€ç®¡ç†

```typescript
// æœ¬åœ°çŠ¶æ€
const [score, setScore] = useState<AlphaTab.model.Score | null>(null);
const [selectedTracks, setSelectedTracks] = useState<Map<number, AlphaTab.model.Track>>(new Map());

// AlphaTab äº‹ä»¶åŒæ­¥
useAlphaTabEvent(api, 'renderStarted', () => {
  // æ›´æ–° selectedTracks
});

useAlphaTabEvent(api, 'scoreLoaded', (loadedScore) => {
  setScore(loadedScore);
});
```

### ä¸ AlphaTab API äº¤äº’

```typescript
// éŸ³è½¨é€‰æ‹©
api.renderTracks(newTracks);

// Solo/Mute
api.changeTrackMute([track], mute);
api.changeTrackSolo([track], solo);

// éŸ³é‡
api.changeTrackVolume([track], volumeRatio);

// éŸ³é¢‘ç§»è°ƒ
api.changeTrackTranspositionPitch([track], pitch);

// å®Œå…¨ç§»è°ƒï¼ˆéœ€æ›´æ–° settingsï¼‰
api.settings.notation.transpositionPitches[trackIndex] = pitch;
api.updateSettings();
api.render();
```

## ä½¿ç”¨æ–¹æ³•

### 1. é›†æˆåˆ° TablatureView

```tsx
import { TracksPanel } from './TracksPanel';

const [tracksPanelOpen, setTracksPanelOpen] = useState(false);

return (
  <div>
    <PlayBar 
      controller={controller}
      onTracksClick={() => setTracksPanelOpen(true)}
    />
    
    <TracksPanel
      controller={controller}
      isOpen={tracksPanelOpen}
      onClose={() => setTracksPanelOpen(false)}
    />
  </div>
);
```

### 2. æ·»åŠ  TracksToggle åˆ° PlayBar

```tsx
import { TracksToggle } from './TracksToggle';

{onTracksClick && (
  <TracksToggle 
    controller={controller} 
    onClick={onTracksClick} 
  />
)}
```

### 3. æ ·å¼å¯¼å…¥

åœ¨ `src/styles/tracks-panel.css` ä¸­å·²åˆ›å»ºæ ·å¼ï¼Œä½¿ç”¨ merge-styles è„šæœ¬åˆå¹¶ã€‚

## æ ·å¼å®šåˆ¶

### CSS å˜é‡é€‚é…

```css
.tracks-panel {
  background-color: var(--background-primary);
  border-right: 1px solid var(--background-modifier-border);
}

.tabflow-btn.is-active {
  background-color: var(--interactive-accent);
  color: var(--text-on-accent);
}

.tabflow-btn.is-muted {
  background-color: var(--background-modifier-error);
  color: var(--text-error);
}
```

### å¸ƒå±€æ–¹å‘

- **TracksPanel**: ä»å·¦ä¾§æ»‘å…¥ï¼ˆ`left: -400px â†’ 0`ï¼‰
- **SettingsPanel**: ä»å³ä¾§æ»‘å…¥ï¼ˆ`right: -400px â†’ 0`ï¼‰

### å“åº”å¼è®¾è®¡

```css
@media (max-width: 768px) {
  .tracks-panel {
    width: 100vw; /* ç§»åŠ¨ç«¯å…¨å± */
    left: -100vw;
  }
}
```

## ä¸ TracksModal å¯¹æ¯”

| ç‰¹æ€§ | TracksModal (æ—§) | TracksPanel (æ–°) |
|------|------------------|------------------|
| **äº¤äº’æ–¹å¼** | å±…ä¸­æ¨¡æ€æ¡† | å·¦ä¾§æ»‘å…¥ |
| **è§†å›¾é®æŒ¡** | å®Œå…¨é®æŒ¡ | éƒ¨åˆ†é®æŒ¡ |
| **å®æ—¶é¢„è§ˆ** | âŒ éœ€å…³é—­æŸ¥çœ‹ | âœ… å¯åŒæ—¶æŸ¥çœ‹ |
| **å¤šé¢æ¿** | âŒ äº’æ–¥ | âœ… å¯åŒæ—¶æ‰“å¼€ |
| **æ ·å¼ä¸€è‡´æ€§** | ç‹¬ç«‹è®¾è®¡ | ä¸ Settings ç»Ÿä¸€ |
| **ç”¨æˆ·ä½“éªŒ** | ä¸­ç­‰ | ä¼˜ç§€ |

## ä¿ç•™ TracksModal

è™½ç„¶æ¨èä½¿ç”¨ TracksPanelï¼Œä½† TracksModal ä¿ç•™ä½œä¸ºå¤‡ç”¨ï¼š
- æŸäº›åœºæ™¯å¯èƒ½æ›´é€‚åˆ Modalï¼ˆå¦‚ç®€å•å¿«é€Ÿé€‰æ‹©ï¼‰
- å¯é€šè¿‡é…ç½®åˆ‡æ¢ä½¿ç”¨æ–¹å¼
- ä»£ç ä¿æŒå…¼å®¹

## å·¥ä½œæµç¤ºä¾‹

### åœºæ™¯ 1ï¼šè°ƒæ•´å¤šéŸ³è½¨æ··éŸ³

1. æ‰“å¼€ TracksPanel
2. è°ƒæ•´å„éŸ³è½¨éŸ³é‡
3. å®æ—¶å¬åˆ°æ•ˆæœ
4. å¾®è°ƒ Solo/Mute
5. å®Œæˆåå…³é—­é¢æ¿

**æ— éœ€é‡å¤æ‰“å¼€/å…³é—­ï¼**

### åœºæ™¯ 2ï¼šä¸ºä¼´å¥è½¬è°ƒ

1. æ‰“å¼€ TracksPanel
2. é€‰æ‹©ä¼´å¥éŸ³è½¨
3. è°ƒæ•´"éŸ³é¢‘ç§»è°ƒ"ï¼ˆä¾‹å¦‚ +2ï¼‰
4. å®æ—¶æ’­æ”¾æŸ¥çœ‹æ•ˆæœ
5. ä¹è°±æ˜¾ç¤ºä¸å˜ï¼Œä»…éŸ³é¢‘å˜åŒ–

### åœºæ™¯ 3ï¼šåŒæ—¶è°ƒæ•´æ˜¾ç¤ºå’Œæ’­æ”¾

1. å·¦ä¾§æ‰“å¼€ TracksPanelï¼ˆéŸ³è½¨æ§åˆ¶ï¼‰
2. å³ä¾§æ‰“å¼€ SettingsPanelï¼ˆæ˜¾ç¤ºè®¾ç½®ï¼‰
3. åŒæ—¶è°ƒæ•´ï¼š
   - TracksPanel: éŸ³é‡ã€ç§»è°ƒ
   - SettingsPanel: ç¼©æ”¾ã€å¸ƒå±€
4. å®æ—¶é¢„è§ˆæ‰€æœ‰å˜åŒ–

## æŠ€æœ¯ç»†èŠ‚

### useAlphaTabEvent Hook

```typescript
useAlphaTabEvent(
  api,
  'renderStarted',
  () => {
    // å›è°ƒé€»è¾‘
  },
  [api] // ä¾èµ–é¡¹
);
```

### éŸ³è½¨é€‰æ‹©é€»è¾‘

```typescript
const handleTrackSelect = (track: Track, selected: boolean) => {
  let newTracks: Track[];
  
  if (selected) {
    newTracks = [...api.tracks, track];
  } else {
    newTracks = api.tracks.filter(t => t !== track);
    // è‡³å°‘ä¿ç•™ä¸€ä¸ªéŸ³è½¨
    if (newTracks.length === 0) return;
  }
  
  // æŒ‰ç´¢å¼•æ’åºå¹¶é‡æ–°æ¸²æŸ“
  newTracks.sort((a, b) => a.index - b.index);
  api.renderTracks(newTracks);
};
```

### éŸ³é‡è®¡ç®—

AlphaTab éŸ³é‡èŒƒå›´æ˜¯ 0-16ï¼ŒUI æ˜¾ç¤ºä¸ºç™¾åˆ†æ¯”ï¼š

```typescript
const volumePercentage = Math.round(volume * 100 / 16);
```

## æœªæ¥æ‰©å±•

- [ ] éŸ³è½¨é‡æ–°æ’åºï¼ˆæ‹–æ‹½ï¼‰
- [ ] éŸ³è½¨é¢œè‰²æ ‡è®°
- [ ] éŸ³è½¨åˆ†ç»„
- [ ] é¢„è®¾é…ç½®ä¿å­˜
- [ ] éŸ³è½¨æœç´¢/è¿‡æ»¤
- [ ] å¿«æ·é”®æ”¯æŒ
- [ ] éŸ³è½¨æ•ˆæœå™¨ï¼ˆEQã€Reverbï¼‰
- [ ] éŸ³è½¨å¯¼å‡ºï¼ˆå•ç‹¬å¯¼å‡ºæŸéŸ³è½¨ï¼‰

## ç›¸å…³æ–‡ä»¶

- `src/player/components/TracksPanel.tsx` - ä¸»ç»„ä»¶
- `src/player/components/TrackItem.tsx` - éŸ³è½¨é¡¹ç»„ä»¶
- `src/player/components/StaffItem.tsx` - äº”çº¿è°±é¡¹ç»„ä»¶
- `src/player/components/TracksToggle.tsx` - åˆ‡æ¢æŒ‰é’®
- `src/styles/tracks-panel.css` - æ ·å¼æ–‡ä»¶
- `src/player/hooks/useAlphaTabEvent.ts` - äº‹ä»¶ Hook

## æ³¨æ„äº‹é¡¹

### âš ï¸ è‡³å°‘ä¿ç•™ä¸€ä¸ªéŸ³è½¨

```typescript
if (newTracks.length === 0) {
  return; // é˜»æ­¢ç§»é™¤æœ€åä¸€ä¸ªéŸ³è½¨
}
```

### âš ï¸ ç§»è°ƒèŒƒå›´é™åˆ¶

- å®Œå…¨ç§»è°ƒï¼š-12 ~ +12ï¼ˆä¸€ä¸ªå…«åº¦ï¼‰
- éŸ³é¢‘ç§»è°ƒï¼š-12 ~ +12
- è¶…å‡ºèŒƒå›´å¯èƒ½å¯¼è‡´éŸ³è´¨ä¸‹é™

### âš ï¸ æ€§èƒ½è€ƒè™‘

- å¤§é‡éŸ³è½¨æ—¶ï¼ˆ>20ï¼‰ï¼Œè€ƒè™‘è™šæ‹Ÿæ»šåŠ¨
- éŸ³é‡è°ƒæ•´ä½¿ç”¨é˜²æŠ–é¿å…é¢‘ç¹ API è°ƒç”¨
- ç§»è°ƒåéœ€é‡æ–°æ¸²æŸ“ï¼Œå¯èƒ½æœ‰å»¶è¿Ÿ

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹å½“å‰é€‰ä¸­éŸ³è½¨

```javascript
console.log('Selected Tracks:', api.tracks.map(t => t.name));
```

### 2. æ£€æŸ¥éŸ³è½¨çŠ¶æ€

```javascript
console.log('Track Playback Info:', {
  mute: track.playbackInfo.isMute,
  solo: track.playbackInfo.isSolo,
  volume: track.playbackInfo.volume
});
```

### 3. ç›‘å¬éŸ³è½¨å˜åŒ–

åœ¨ DevTools ä¸­è®¾ç½®æ–­ç‚¹ï¼š
- `api.renderTracks()` è°ƒç”¨
- `useAlphaTabEvent('renderStarted')` å›è°ƒ

## æ€»ç»“

TracksPanel æä¾›äº†æ›´ä¼˜ç§€çš„éŸ³è½¨ç®¡ç†ä½“éªŒï¼š
- ğŸ¯ å®æ—¶é¢„è§ˆè°ƒæ•´æ•ˆæœ
- ğŸ¨ ä¸ Settings é¢æ¿é£æ ¼ç»Ÿä¸€
- ğŸš€ æå‡ç”¨æˆ·æ“ä½œæ•ˆç‡
- ğŸ’¡ ç¬¦åˆç°ä»£ DAW è½¯ä»¶çš„äº¤äº’ä¹ æƒ¯

è¿™æ˜¯ä¸€ä¸ªæ˜¾è‘—çš„ UX æ”¹è¿›ï¼ğŸ‰
