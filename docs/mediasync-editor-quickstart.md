# MediaSync 编辑器 - 快速开始指南

## 功能概述

MediaSync 编辑器提供了完整的媒体同步编辑界面，允许用户：

1. 📊 **可视化音频波形** - 查看立体声波形
2. 📍 **编辑同步点** - 拖拽调整同步标记
3. 🎯 **精确对齐** - 将乐谱与媒体文件对齐
4. 🎛️ **缩放和导航** - 灵活地浏览长音频

## 快速开始

### 1️⃣ 打开 MediaSync 面板

在播放器底部找到 "Media Sync" 按钮，点击打开面板。

### 2️⃣ 加载媒体文件

#### 方式 A: 从 Vault 加载
```
基础设置 标签页
  → "📁 选择媒体文件..." 按钮
  → 选择音频或视频文件
```

#### 方式 B: 输入 URL
```
基础设置 标签页
  → 在对应输入框输入媒体 URL
  → 点击 "加载" 按钮
```

#### 方式 C: YouTube 视频
```
基础设置 标签页
  → YouTube 输入框
  → 输入完整 URL 或 11 位视频 ID
  → 点击 "加载" 按钮
```

### 3️⃣ 切换到同步编辑器

点击 "📍 同步编辑器" 标签页，显示波形和同步点面板。

### 4️⃣ 编辑同步点

#### 查看波形
- 上半部分显示音频波形
- 左右声道分别绘制
- 红色竖线表示当前播放位置

#### 查看同步点
- 下半部分显示同步点标记
- 红色三角形表示已激活的同步点
- 灰色三角形表示禁用的同步点
- 悬停显示详细信息

#### 交互操作

**拖拽标记**
```
1. 鼠标放在同步点上
2. 光标变为 "grab" 手形
3. 按下左键并拖拽
4. 松开鼠标完成调整
5. 自动更新相邻标记位置
```

**激活/禁用标记**
```
1. 在同步点上双击
2. 红色变灰色（禁用）或灰色变红色（激活）
3. 禁用的标记不参与同步计算
```

**寻址到特定位置**
```
1. 在同步点面板中点击任意位置
2. 播放头跳转到该时间点
3. 媒体播放器自动同步
```

### 5️⃣ 使用工具栏

#### 缩放控制
- `− 缩小` - 缩小视图（显示更长的音频）
- `%` - 显示当前缩放比例，点击重置为 100%
- `+ 放大` - 放大视图（更详细地编辑）

#### 统计信息
```
时长: X.XXs | 标记数: N
虚拟宽度: XXXpx | 缩放: X.XXx
播放时间: X.XXs / X.XXs
```

## 常见任务

### 对齐乐谱与音频

1. 打开音频文件
2. 切换到同步编辑器
3. 找到乐谱的起始点对应的音频位置
4. 拖拽起始标记到正确位置
5. 调整各小节的标记确保对齐
6. 根据需要激活/禁用中间标记

### 精细调整

1. 使用缩放工具放大要编辑的区域
2. 逐个调整同步点
3. 观察波形和标记的关系
4. 确保标记对齐音频的节拍

### 导出同步数据

🚧 **功能开发中...**

计划支持导出为：
- TypeScript 代码
- C# 代码
- Kotlin 代码
- alphaTex 格式

## 界面说明

### 波形面板 (上)
```
┌─────────────────────────────┐
│  L  ╱╲  ╱╲                 │
│  ╱  │  │╲  ╱╲             │  ← 左声道
│ ─────────────────────────── 中线
│  │  ║  ║  ║                │
│  ║  ║  ║  ║  ╱╲           │  ← 右声道
│  ╲  ╱  ╲  ╱  ╱ ╲          │
├─────────────────────────────┤
│  0:00  0:05  0:10  0:15    │  ← 时间轴
└─────────────────────────────┘
  ▲
  播放光标 (红色竖线)
```

### 同步点面板 (下)
```
┌─────────────────────────────┐
│  △ ▼ ▼    ▼   △ ▼        │  ← 标记头
│  ║ ║ ║    ║   ║ ║        │
│  ║ ║ ║    ║   ║ ║        │  ← 标记线
│ 1  2 3    5   7 8 bpm    │
│ (120)    (120)   (120)   │  ← BPM 标签
└─────────────────────────────┘

△ = 红色（已激活的同步点）
▼ = 灰色（禁用的同步点）
```

## 快捷键（计划中）

| 功能 | 快捷键 |
|------|--------|
| 放大 | `Ctrl ++` 或 `Ctrl =` |
| 缩小 | `Ctrl -` |
| 重置缩放 | `Ctrl 0` |
| 撤销 | `Ctrl Z` |
| 重做 | `Ctrl Shift Z` |
| 搜索 | `Ctrl F` |
| 帮助 | `F1` 或 `?` |

## 常见问题

### Q: 波形为空白？
A: 确保已正确加载音频文件。检查：
1. 文件格式是否支持（MP3、WAV、OGG 等）
2. 文件是否完整且可读
3. 浏览器控制台是否有错误提示

### Q: 同步点不显示？
A: 这是正常的。初次加载时需要手动添加同步点。计划中的功能：
1. 自动同步算法
2. 导入预设同步点

### Q: 拖拽标记时很卡顿？
A: 尝试：
1. 减少同步点数量
2. 使用 "缩小" 减少渲染区域
3. 关闭浏览器中的其他标签页

### Q: 如何保存编辑结果？
A: 同步点数据自动保存到组件状态。计划中支持：
1. 导出为代码
2. 保存为配置文件
3. 自动同步点备份

## 技术细节

### 坐标系统
- 单位：毫秒（时间）和像素（屏幕）
- 转换: `x_pixel = leftPadding + time_ms * pixelPerMs * zoom`
- 反向: `time_ms = (x_pixel - leftPadding) / (pixelPerMs * zoom)`

### 缩放级别
- 范围：0.5x 到 10x
- 步长：1.2 倍
- 默认：1.0x（100%）

### 采样率
- 默认：44100 Hz
- 范围：根据实际音频文件

### 波形计算
- 算法：最大值采样
- 精度：1 像素 1 次采样
- 优化：按需绘制可见区域

## 下一步

📋 **待实现功能**：
- [ ] 自动同步（根据速度变化）
- [ ] 代码生成导出
- [ ] 撤销/重做
- [ ] 同步点预设
- [ ] 性能优化

🎯 **优化方向**：
- [ ] 支持更大的音频文件
- [ ] 改进波形分析算法
- [ ] 添加热键快捷键
- [ ] 国际化支持

## 支持和反馈

如有问题或建议，欢迎：
- 📝 提交 Issue
- 💬 讨论和建议
- 🐛 报告 Bug
- ✨ 贡献代码

---

**版本**: 1.0.0  
**最后更新**: 2025-10-16  
**状态**: 正式发布 ✅
